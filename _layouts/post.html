---
layout: base
---

<!-- Reading Progress Bar -->
<div class="reading-progress-bar">
  <div class="reading-progress-fill"></div>
</div>

{% include header.html type="post" %}

<main class="{% if page.full-width %} container-fluid {% else %} container-md {% endif %}">
  <div class="row">
    <div class="col-md-3">
      {% include sidebar-categories.html %}
      
      <!-- Table of Contents -->
      <div class="toc-sidebar d-none d-md-block" id="toc-sidebar">
        <h4><i class="fas fa-list"></i> 목차</h4>
        <nav id="toc-nav">
          <!-- TOC will be generated by JavaScript -->
        </nav>
      </div>
    </div>
    
    <div class="{% if page.full-width %} col {% else %} col-md-9 {% endif %}">
      
      <!-- Enhanced Post Header -->
      <div class="post-header">
        <div class="post-meta-enhanced">
          <div class="post-meta-row">
            <span class="post-date">
              <i class="fas fa-calendar-alt"></i>
              {{ page.date | date: "%B %d, %Y" }}
            </span>
            {% if page.category %}
            <span class="post-category">
              <i class="fas fa-folder"></i>
              <a href="/{{ page.category }}">{{ page.category | capitalize }}</a>
            </span>
            {% endif %}
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              <span id="reading-time"></span>
            </span>
          </div>
          {% if page.author %}
          <div class="post-author">
            <i class="fas fa-user"></i>
            {{ page.author }}
          </div>
          {% endif %}
        </div>
        
        {% if page.subtitle %}
        <p class="post-subtitle-enhanced">{{ page.subtitle }}</p>
        {% endif %}
      </div>

      {% if page.gh-repo %}
        {% assign gh_split =  page.gh-repo | split:'/'  %}
        {% assign gh_user =  gh_split[0]  %}
        {% assign gh_repo =  gh_split[1]  %}

        <div id="header-gh-btns">
          {% if page.gh-badge.size > 0 %}
            {% for badge in page.gh-badge %}
              {% case badge %}
                {% when 'star'%}
                  <iframe src="https://ghbtns.com/github-btn.html?user={{ gh_user }}&repo={{ gh_repo }}&type=star&count=true" frameborder="0" scrolling="0" width="120px" height="20px"></iframe>
                {% when 'watch'%}
                  <iframe src="https://ghbtns.com/github-btn.html?user={{ gh_user }}&repo={{ gh_repo }}&type=watch&v=2&count=true" frameborder="0" scrolling="0" width="120px" height="20px"></iframe>
                {% when 'fork'%}
                  <iframe src="https://ghbtns.com/github-btn.html?user={{ gh_user }}&repo={{ gh_repo }}&type=fork&count=true" frameborder="0" scrolling="0" width="120px" height="20px"></iframe>
                {% when 'follow'%}
                  <iframe src="https://ghbtns.com/github-btn.html?user={{ gh_user }}&type=follow&count=true" frameborder="0" scrolling="0" width="220px" height="20px"></iframe>
              {% endcase %}
            {% endfor %}
          {% endif %}
        </div>
      {% endif %}

      {% if page.before-content %}
        <div class="before-content">
          {% for file in page.before-content %}
            {% include {{ file }} %}
          {% endfor %}
        </div>
      {% endif %}

      <!-- Mobile TOC Toggle -->
      <div class="mobile-toc-toggle d-md-none">
        <button class="btn btn-outline-primary" type="button" data-bs-toggle="collapse" data-bs-target="#mobile-toc">
          <i class="fas fa-list"></i> 목차 보기
        </button>
        <div class="collapse" id="mobile-toc">
          <div class="card card-body mt-2">
            <nav id="mobile-toc-nav">
              <!-- TOC will be generated by JavaScript -->
            </nav>
          </div>
        </div>
      </div>

      <div class="blog-post-enhanced">
        {{ content }}
      </div>

      {% if page.tags.size > 0 %}
        <div class="blog-tags-enhanced">
          <h5><i class="fas fa-tags"></i> 태그</h5>
          <div class="tags-container">
            {% for tag in page.tags %}
              <a href="{{ '/tags' | relative_url }}#{{- tag -}}" class="tag-badge">
                {{ tag }}
              </a>
            {% endfor %}
          </div>
        </div>
      {% endif %}

      {% if page.after-content %}
        <div class="after-content">
          {% for file in page.after-content %}
            {% include {{ file }} %}
          {% endfor %}
        </div>
      {% endif %}

      {% if page.social-share %}
        {% include social-share.html %}
      {% endif %}

      <!-- Enhanced Post Navigation -->
      <nav class="post-navigation">
        <div class="nav-links">
          {% if page.previous.url %}
          <div class="nav-previous">
            <a href="{{ page.previous.url | relative_url }}" class="nav-link">
              <div class="nav-direction">
                <i class="fas fa-arrow-left"></i>
                <span>이전 글</span>
              </div>
              <div class="nav-title">{{ page.previous.title | strip_html | truncate: 50 }}</div>
            </a>
          </div>
          {% endif %}
          
          {% if page.next.url %}
          <div class="nav-next">
            <a href="{{ page.next.url | relative_url }}" class="nav-link">
              <div class="nav-direction">
                <span>다음 글</span>
                <i class="fas fa-arrow-right"></i>
              </div>
              <div class="nav-title">{{ page.next.title | strip_html | truncate: 50 }}</div>
            </a>
          </div>
          {% endif %}
        </div>
      </nav>
      
      {% include comments.html %}
    </div>
  </div>
</main>

<!-- Post Enhancement Scripts -->
<script>
document.addEventListener('DOMContentLoaded', function() {
  // Reading time calculation
  const content = document.querySelector('.blog-post-enhanced');
  const wordCount = content.innerText.split(/\s+/).length;
  const readingTime = Math.ceil(wordCount / 200); // 200 words per minute
  document.getElementById('reading-time').textContent = `${readingTime}분 읽기`;
  
  // Generate Table of Contents
  const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');
  const tocNav = document.getElementById('toc-nav');
  const mobileTocNav = document.getElementById('mobile-toc-nav');
  
  if (headings.length > 0) {
    let tocHTML = '<ul class="toc-list">';
    
    headings.forEach((heading, index) => {
      const id = `heading-${index}`;
      heading.id = id;
      const level = parseInt(heading.tagName.substring(1));
      const text = heading.textContent;
      
      tocHTML += `<li class="toc-item toc-level-${level}">
        <a href="#${id}" class="toc-link">${text}</a>
      </li>`;
    });
    
    tocHTML += '</ul>';
    tocNav.innerHTML = tocHTML;
    mobileTocNav.innerHTML = tocHTML;
    
    // Smooth scroll for TOC links
    document.querySelectorAll('.toc-link').forEach(link => {
      link.addEventListener('click', function(e) {
        e.preventDefault();
        const targetId = this.getAttribute('href').substring(1);
        const targetElement = document.getElementById(targetId);
        
        if (targetElement) {
          const offsetTop = targetElement.getBoundingClientRect().top + window.pageYOffset - 100;
          window.scrollTo({
            top: offsetTop,
            behavior: 'smooth'
          });
        }
      });
    });
  } else {
    document.querySelector('.toc-sidebar').style.display = 'none';
    document.querySelector('.mobile-toc-toggle').style.display = 'none';
  }
  
  // Reading progress bar
  const progressBar = document.querySelector('.reading-progress-fill');
  
  window.addEventListener('scroll', function() {
    const scrollTop = window.pageYOffset;
    const docHeight = document.body.scrollHeight - window.innerHeight;
    const scrollPercent = (scrollTop / docHeight) * 100;
    
    progressBar.style.width = scrollPercent + '%';
    
    // Highlight current TOC item
    let currentHeading = null;
    headings.forEach(heading => {
      const rect = heading.getBoundingClientRect();
      if (rect.top <= 150) {
        currentHeading = heading;
      }
    });
    
    // Remove active class from all TOC links
    document.querySelectorAll('.toc-link').forEach(link => {
      link.classList.remove('active');
    });
    
    // Add active class to current TOC link
    if (currentHeading) {
      const currentLink = document.querySelector(`a[href="#${currentHeading.id}"]`);
      if (currentLink) {
        currentLink.classList.add('active');
      }
    }
  });
  
  // Code block enhancements
  document.querySelectorAll('pre code').forEach(codeBlock => {
    const pre = codeBlock.parentElement;
    
    // Add copy button
    const copyButton = document.createElement('button');
    copyButton.className = 'code-copy-btn';
    copyButton.innerHTML = '<i class="fas fa-copy"></i>';
    copyButton.title = '코드 복사';
    
    copyButton.addEventListener('click', function() {
      navigator.clipboard.writeText(codeBlock.textContent).then(() => {
        copyButton.innerHTML = '<i class="fas fa-check"></i>';
        setTimeout(() => {
          copyButton.innerHTML = '<i class="fas fa-copy"></i>';
        }, 2000);
      });
    });
    
    pre.style.position = 'relative';
    pre.appendChild(copyButton);
  });
  
  // Image zoom functionality
  const images = document.querySelectorAll('.blog-post-enhanced img');
  images.forEach(img => {
    img.addEventListener('click', function() {
      const imageZoom = document.createElement('div');
      imageZoom.className = 'image-zoom';
      imageZoom.innerHTML = `
        <div class="image-zoom-close">&times;</div>
        <img src="${this.src}" alt="${this.alt}">
      `;
      
      document.body.appendChild(imageZoom);
      imageZoom.style.display = 'block';
      
      // Close on click
      imageZoom.addEventListener('click', function() {
        document.body.removeChild(imageZoom);
      });
      
      // Close on ESC key
      document.addEventListener('keydown', function(e) {
        if (e.key === 'Escape' && document.querySelector('.image-zoom')) {
          const zoom = document.querySelector('.image-zoom');
          if (zoom) {
            document.body.removeChild(zoom);
          }
        }
      });
    });
  });
});
</script>
